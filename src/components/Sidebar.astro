---
import ThemeToggle from './ThemeToggle.astro'
import { getSession } from 'auth-astro/server'
import { Image } from 'astro:assets'

const session = await getSession(Astro.request)
---
<button
	id='separator-sidebar'
	type='button'
	class='ms-3 top-2 z-10 inline-flex fixed items-center rounded-lg p-2 text-sm text-gray-500 hover:bg-gray-100 transition-transform dark:text-gray-400 dark:hover:bg-gray-700'
>
	<span class='sr-only'>Open sidebar</span>
	<svg class='h-6 w-6' aria-hidden='true' fill='currentColor' viewBox='0 0 20 20'>
		<path
			clip-rule='evenodd'
			fill-rule='evenodd'
			d='M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z'
		></path>
	</svg>
</button>

<aside
	id='sidebar'
	class='fixed left-0 top-0 z-40 h-screen w-64 -translate-x-full transition-transform shadow-gray-800 dark:shadow-gray-500'
>
	<div class='h-full overflow-y-auto bg-gray-50 px-3 py-4 dark:bg-gray-800'>
		{session && (
			<section class="flex flex-row gap-3">
				<Image src={session.user?.image ?? ''} alt={`Foto de perfil de ${session.user?.name}`} inferSize={true} class='rounded-xl size-16' />
				<h3 class='text-lg font-semibold text-black dark:text-white m-auto'>{session.user?.name}</h3>
			</section>
		)}
		<ul class='space-y-2 font-medium border-t border-gray-200 dark:border-gray-700 mt-3'>
			<li>
				<a
					href='/dashboard'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
					<svg viewBox="0 0 24 24" fill="currentColor" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
						<path fill-rule="evenodd" d="M2.25 5.25a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3V15a3 3 0 0 1-3 3h-3v.257c0 .597.237 1.17.659 1.591l.621.622a.75.75 0 0 1-.53 1.28h-9a.75.75 0 0 1-.53-1.28l.621-.622a2.25 2.25 0 0 0 .659-1.59V18h-3a3 3 0 0 1-3-3V5.25Zm1.5 0v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5Z" clip-rule="evenodd" />
					</svg>				
					<span class='ms-3'>Dashboard</span>
				</a>
			</li>
			<li>
				<a
					href='/entries'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
						<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
						<path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" />
						<path d="M12 3v3m0 12v3" />
					</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Ingresos</span>
				</a>
			</li>
			<li>
				<a
					href='/exits'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
					<svg
						class='size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white'
						aria-hidden='true'
						fill='currentColor'
						viewBox='0 0 18 20'
					>
						<path
							d='M17 5.923A1 1 0 0 0 16 5h-3V4a4 4 0 1 0-8 0v1H2a1 1 0 0 0-1 .923L.086 17.846A2 2 0 0 0 2.08 20h13.84a2 2 0 0 0 1.994-2.153L17 5.923ZM7 9a1 1 0 0 1-2 0V7h2v2Zm0-5a2 2 0 1 1 4 0v1H7V4Zm6 5a1 1 0 1 1-2 0V7h2v2Z'
						></path>
					</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Gastos</span>
				</a>
			</li>
			<li>
				<a
					href='/analysis'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
					<svg viewBox="0 0 24 24" fill="currentColor" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
						<path fill-rule="evenodd" d="M2.25 13.5a8.25 8.25 0 0 1 8.25-8.25.75.75 0 0 1 .75.75v6.75H18a.75.75 0 0 1 .75.75 8.25 8.25 0 0 1-16.5 0Z" clip-rule="evenodd" />
						<path fill-rule="evenodd" d="M12.75 3a.75.75 0 0 1 .75-.75 8.25 8.25 0 0 1 8.25 8.25.75.75 0 0 1-.75.75h-7.5a.75.75 0 0 1-.75-.75V3Z" clip-rule="evenodd" />
					</svg>				
					<span class='ms-3 flex-1 whitespace-nowrap'>Análisis</span>
				</a>
			</li>
			<li>
				<a
					href='/recommendations'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
					<svg
						class='size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white'
						aria-hidden='true'
						fill='currentColor'
						viewBox='0 0 20 20'
					>
						<path d='M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.96 2.96 0 0 0 .13 5H5Z'></path>
						<path
							d='M6.737 11.061a2.961 2.961 0 0 1 .81-1.515l6.117-6.116A4.839 4.839 0 0 1 16 2.141V2a1.97 1.97 0 0 0-1.933-2H7v5a2 2 0 0 1-2 2H0v11a1.969 1.969 0 0 0 1.933 2h12.134A1.97 1.97 0 0 0 16 18v-3.093l-1.546 1.546c-.413.413-.94.695-1.513.81l-3.4.679a2.947 2.947 0 0 1-1.85-.227 2.96 2.96 0 0 1-1.635-3.257l.681-3.397Z'
						></path>
						<path
							d='M8.961 16a.93.93 0 0 0 .189-.019l3.4-.679a.961.961 0 0 0 .49-.263l6.118-6.117a2.884 2.884 0 0 0-4.079-4.078l-6.117 6.117a.96.96 0 0 0-.263.491l-.679 3.4A.961.961 0 0 0 8.961 16Zm7.477-9.8a.958.958 0 0 1 .68-.281.961.961 0 0 1 .682 1.644l-.315.315-1.36-1.36.313-.318Zm-5.911 5.911 4.236-4.236 1.359 1.359-4.236 4.237-1.7.339.341-1.699Z'
						></path>
					</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Recomendaciones</span>
				</a>
			</li>
			<li>
				<a
					href='/savings'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
				<svg viewBox="0 0 256 256" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
					<path fill="currentColor" d="M200 120a16 16 0 1 1-16-16a16 16 0 0 1 16 16m-44-56h-40a12 12 0 0 0 0 24h40a12 12 0 0 0 0-24m100 48v32a28 28 0 0 1-27.54 28l-15.26 42.73A20 20 0 0 1 194.36 228h-12.72a20 20 0 0 1-18.84-13.27l-1-2.73h-51.63l-1 2.73A20 20 0 0 1 90.36 228H77.64a20 20 0 0 1-18.84-13.27l-12.3-34.45a91.63 91.63 0 0 1-20.75-42.48A11.91 11.91 0 0 0 24 144a12 12 0 0 1-24 0a36.07 36.07 0 0 1 24.56-34.13A92.13 92.13 0 0 1 116 28h104a12 12 0 0 1 0 24h-10a92 92 0 0 1 22.48 31.45l.42 1A28.05 28.05 0 0 1 256 112m-24 0a4 4 0 0 0-4-4h-3.66a12 12 0 0 1-11.45-8.41A68 68 0 0 0 148 52h-32a68 68 0 0 0-50.14 113.94a11.85 11.85 0 0 1 2.45 4.06l12.15 34h7.08l2.87-8a12 12 0 0 1 11.3-8h68.58a12 12 0 0 1 11.3 8l2.87 8h7.08l17.16-48a12 12 0 0 1 11.3-8h8a4 4 0 0 0 4-4Z"/>
				</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Ahorros</span>
				</a>
			</li>
			<li>
				<a
					href='/reminders'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
				<svg viewBox="0 0 16 16" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
					<path fill="currentColor" d="M8 1.5c-2.363 0-4 1.69-4 3.75c0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848c.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25C2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259c-.095.115-.184.22-.268.319c-.207.245-.383.453-.541.681c-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489c.203-.292.45-.584.673-.848c.075-.088.147-.173.213-.253c.561-.679.985-1.32.985-2.304c0-2.06-1.637-3.75-4-3.75M5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75"/>
				</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Recordatorios</span>
				</a>
			</li>
		</ul>
		<ul class='mt-4 space-y-2 border-t border-gray-200 pt-4 font-medium dark:border-gray-700'>
			<li>
				<a
					href='/'
					class='group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
				>
				<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white">
					<path stroke="none" d="M0 0h24v24H0z" fill="none"/>
					<path d="M12.707 2.293l9 9c.63 .63 .184 1.707 -.707 1.707h-1v6a3 3 0 0 1 -3 3h-1v-7a3 3 0 0 0 -2.824 -2.995l-.176 -.005h-2a3 3 0 0 0 -3 3v7h-1a3 3 0 0 1 -3 -3v-6h-1c-.89 0 -1.337 -1.077 -.707 -1.707l9 -9a1 1 0 0 1 1.414 0m.293 11.707a1 1 0 0 1 1 1v7h-4v-7a1 1 0 0 1 .883 -.993l.117 -.007z" />
				</svg>
					<span class='ms-3 flex-1 whitespace-nowrap'>Inicio</span>
				</a>
			</li>
			{session && (
				<li>
					<button
						id="logout"
						class='group flex items-center rounded-lg p-2 text-gray-900 transition duration-75 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700'
					>
						<svg
							class='size-5 flex-shrink-0 text-gray-500 transition duration-75 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white'
							aria-hidden='true'
							fill='none'
							viewBox='0 0 18 16'
						>
							<path
								stroke='currentColor'
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M1 8h11m0 0L8 4m4 4-4 4m4-11h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-3'></path>
						</svg>
						<span class='ms-3'>Cerrar Sesión</span>
					</button>
				</li>
			)}
			<li class="flex flex-col gap-3 mt-3">
				<ThemeToggle />
			</li>
		</ul>
		<!-- Cambiar Idioma -->
	</div>
</aside>

<script>
	import { $ } from '@lib/dom-selector'
	import { signOut } from 'auth-astro/client'
	document.addEventListener('astro:page-load', async () => {
		let isSidebarOpen = false
		const $logout = $('#logout')

		if ($logout) {
			$logout.onclick = () => signOut()
		}

		document.getElementById('separator-sidebar')?.addEventListener('click', () => {
			const sidebar = document.getElementById('sidebar')!
			const separator = document.getElementById('separator-sidebar')!

			sidebar.classList.toggle('-translate-x-full', isSidebarOpen)
			sidebar.classList.toggle('shadow-2xl', !isSidebarOpen)
			separator.classList.toggle('translate-x-64', !isSidebarOpen)

			isSidebarOpen = !isSidebarOpen
		})
	})
</script>
