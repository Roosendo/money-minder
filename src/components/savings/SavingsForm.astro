---
import AlertMessage from '@components/AlertMessage.astro'
---

<form id="savings-form" class="bg-gray-200 dark:bg-gray-900 text-gray-700 dark:text-gray-200 p-6 rounded-lg shadow-md max-w-md mx-auto mt-6">
  <h2 class="text-xl font-bold mb-4 text-center">Agregar Nuevo Objetivo de Ahorro</h2>
  <div class="mb-4">
    <label for="goal-name" class="block font-semibold mb-2">Nombre del objetivo</label>
    <input type="text" id="goal-name" class="block p-2.5 w-full z-20 ps-10 text-sm text-gray-900 bg-gray-50 rounded-lg border-e-gray-50 border-e-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-e-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500" placeholder="PlayStation 5" required />
  </div>
  <div class="mb-4">
    <label for="target-amount" class="block font-semibold mb-2">Monto objetivo</label>
    <input type="number" id="target-amount" class="block p-2.5 w-full z-20 ps-10 text-sm text-gray-900 bg-gray-50 rounded-lg border-e-gray-50 border-e-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-e-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500" placeholder="3.99" required step="0.01" />
  </div>
  <div class="mb-4">
    <label for="current-amount" class="block font-semibold mb-2">Monto actual (Por defecto es $0)</label>
    <input type="number" id="current-amount" class="block p-2.5 w-full z-20 ps-10 text-sm text-gray-900 bg-gray-50 rounded-lg border-e-gray-50 border-e-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-e-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500" placeholder="3.99" step="0.01" />
  </div>
  <div class="mb-4">
    <label for="start-date" class="block font-semibold mb-2">Fecha de inicio</label>
    <input type="date" id="start-date" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Fecha de inicio">
  </div>
  <div class="mb-4">
    <label for="end-date" class="block font-semibold mb-2">Fecha de fin</label>
    <input type="date" id="end-date" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Fecha de fin">
  </div>
  <button type="submit" class="w-full bg-teal-500 text-white font-semibold p-2 mb-4 rounded-md hover:bg-teal-600">Agregar Objetivo</button>
  <AlertMessage alertId='alert-success' alertMessage='Ahorro registrado 😁' typeAlert='success' />
  <AlertMessage alertId='alert-error' alertMessage="Error al registrar el ahorro 😔" typeAlert='warning' />
</form>
<div id="savings-list" class="max-w-lg mx-auto my-6 space-y-4">
  <!-- Cada objetivo de ahorro se renderiza aquí -->
</div>

<script>
  import { $ } from '@lib/dom-selector'
  import { handleFormSubmit, init } from '@utils/savings-form'

  document.addEventListener('astro:page-load', () => {
    const $savingForm = $('#savings-form') as HTMLFormElement
    const $alertMessage = $('#alert-success') as HTMLDivElement
    const $alertWarning = $('#alert-error') as HTMLDivElement
    const $divElement = $('#savings-list') as HTMLDivElement

    $savingForm?.addEventListener('submit', (e) => handleFormSubmit(e, $savingForm, $alertMessage, $alertWarning, $divElement))
    init($divElement)
  })
</script>
