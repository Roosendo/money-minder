---
import GitHub from '@icons/GitHub.astro'
import Google from '@icons/Google.astro'
---

<div class='flex flex-col space-y-3'>
  <button
    id='login-g'
    class='w-full rounded-lg bg-gray-200 px-5 py-2.5 text-center text-sm font-bold text-black hover:bg-gray-300 focus:outline-none sm:w-auto'
  >
    <Google class='mr-2 inline-block size-5' />
    Ingresar
  </button>
  <button
    id='login-gh'
    class='w-full rounded-lg bg-gray-200 px-5 py-2.5 text-center text-sm font-bold text-black hover:bg-gray-300 focus:outline-none sm:w-auto'
  >
    <GitHub class='mr-2 inline-block size-5' />
    Ingresar
  </button>
</div>

<script>
  import { $ } from '@lib/dom-selector'

  document.addEventListener('astro:page-load', async () => {
    const $loginButton = $('#login-g')
    const $loginButtonGH = $('#login-gh')

    if ($loginButton) {
      $loginButton.onclick = () => {
        window.location.href = 'https://money-minder-api.vercel.app/api/google'
      }
    }

    if ($loginButtonGH) {
      $loginButtonGH.onclick = () => {
        window.location.href = 'https://money-minder-api.vercel.app/api/github'
      }
    }
  })
</script>

<script>
  document.addEventListener('astro:page-load', async () => {
    const params = new URLSearchParams(window.location.search)
    const user = params.get('user')

    if (user) {
      const userData = JSON.parse(decodeURIComponent(user))
      localStorage.setItem('user', JSON.stringify(userData))
      document.cookie = `user=${encodeURIComponent(JSON.stringify(userData.user))}; path=/;`
      window.location.href = '/login'
    }
  })
</script>
